<?xml version="1.0"?>
<recovery>
	<pages>
		<page name="main">
			<action>
				<condition var1="use_pass" var2="1"/>
				<condition var1="pass_open" var2="0"/>
				<condition var1="tw_has_mtp" var2="1"/>
				<condition var1="tw_mtp_enabled" var2="1"/>
				<action function="stopmtp"/>
			</action>
			<action>
				<condition var1="use_pass" var2="1"/>
				<condition var1="pass_open" var2="0"/>
				<action function="cmd">
					stop adbd
					setprop sys.usb.config charging
				</action>
				<action function="set">pass_enter=</action>
				<action function="set">pass_govno=0</action>
				<action function="page">password_enter</action>
			</action>
			
			<action>
				<actions>
					<action function="overlay"/>
					<action function="set">tw_clear_destination=filemanagerlist</action>
					<action function="page">clear_vars</action>
				</actions>
			</action>
		</page>
		
		<page name="aroma_busy">
			<background color="%background%"/>
			<template name="background_image"/>
			
			<fill color="%lightransparent%">
				<placement x="0" y="0" w="%screen_w%" h="%status_h%"/>
			</fill>
			
			<template name="statusbarinfo"/>
			
			<image>
				<image resource="aroma_folder"/>
				<placement x="%center_x%" y="%center_y%" placement="4"/>
			</image>
			<text style="bs_text">
				<placement x="%center_x%" y="%busy_text_l%" placement="4"/>
				<condition var1="navbar_disable" op="!=" var2="1"/>
				<text>{@starting_aroma=Starting AromaFM...}</text>
			</text>
			<text style="bs_text">
				<placement x="%center_x%" y="%busy_text%" placement="4"/>
				<condition var1="navbar_disable" var2="1"/>
				<text>{@starting_aroma=Starting AromaFM...}</text>
			</text>
			
			<action>
				<condition var1="tw_operation_state" var2="1"/>
				<action function="set">tw_signed_zip_verify=%tw_signed_zip_verify_tmp%</action>
			</action>
			
			<action>
				<condition var1="tw_operation_state" var2="1"/>
				<condition var1="tw_operation_status" op="!=" var2="0"/>
				<action function="set">install_back=main</action>
				<action function="page">flash_done</action>
			</action>
			
			<action>
				<condition var1="tw_operation_state" var2="1"/>
				<condition var1="tw_operation_status" var2="0"/>
				<action function="page">main</action>
			</action>
		</page>
		
		<page name="flash_key">
			<action>
				<condition var1="flashlight_on" var2="1"/>
				<action function="set">tw_busy_temp=%tw_busy%</action>
				<action function="cmd">
					flashfile=/sys/class/leds/%flashlight_default%/brightness
					state="$(cat $flashfile)"
					if [[ $state = 0 ]]
					then
						echo %flash_active% > $flashfile
					else
						echo 0 > $flashfile
					fi
				</action>
				<action function="set">tw_busy=%tw_busy_temp%</action>
			</action>
		</page>
		
		<page name="main2">
			<template name="body"/>
			
			<template name="ab_main"/>

			<template name="statusbarinfo"/>

			<text style="text_ab_title">
				<placement x="%col1_x%" y="%ab_bc_y%"/>
				<text>{@fordowns_recovery=Recovery}</text>
			</text>

			<button>
				<placement x="%ab_btn1_x%" y="%ab_y%"/>
				<image resource="actionbar_settings" highlightresource="actionbar_settings_hl"/>
				<action function="page">settings</action>
			</button>
			
			<button>
				<condition var1="flashlight_on" var2="1"/>
				<placement x="%ab_btn2_x%" y="%ab_y%"/>
				<image resource="actionbar_flash" highlightresource="actionbar_flash_hl"/>
				<action function="overlay">flash_key</action>
				<action function="overlay"/>
			</button>
			
			<button>
				<condition var1="flashlight_on" var2="1"/>
				<condition var1="use_pass" var2="1"/>
				<placement x="%ab_btn3_x%" y="%ab_y%"/>
				<image resource="actionbar_encr_ena" highlightresource="actionbar_encr_ena_hl"/>
				<action function="set">pass_open=0</action>
				<action function="page">main</action>
			</button>
			<button>
				<condition var1="flashlight_on" var2="0"/>
				<condition var1="use_pass" var2="1"/>
				<placement x="%ab_btn2_x%" y="%ab_y%"/>
				<image resource="actionbar_encr_ena" highlightresource="actionbar_encr_ena_hl"/>
				<action function="set">pass_open=0</action>
				<action function="page">main</action>
			</button>
			
			<image>
				<condition var1="menu_btn_solid" var2="0"/>
				<placement x="%col1_x%" y="%mb_row1_y%"/>
				<image resource="mb_install"/>
			</image>

			<fill color="%accent%">
				<condition var1="alt_style_btn" var2="0"/>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%mb_icon_x%" y="%mb_row1_icon_y%" w="%mb_icon_w%" h="%mb_icon_h%"/>
			</fill>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x%" y="%mb_row1_y%"/>
				<image resource="mb_install_color"/>
			</image>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x_neg%" y="%mb_row1_y%" placement="1"/>
				<image resource="mb_color_extension"/>
			</image>

			<text style="mb_text">
				<placement x="%col1_x_indent%" y="%mb_row1_text_y%"/>
				<text>{@install_btn=Install}</text>
			</text>

			<button style="mb_btn">
				<placement x="%col1_x%" y="%mb_row1_y%" w="%content_w%" h="%mb_h%"/>
				<actions>
					<action function="queueclear"/>
					<action function="page">install</action>
				</actions>
			</button>

			<image>
				<condition var1="menu_btn_solid" var2="0"/>
				<placement x="%col1_x%" y="%mb_row2_y%"/>
				<image resource="mb_wipe"/>
			</image>

			<fill color="%accent%">
				<condition var1="alt_style_btn" var2="0"/>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%mb_icon_x%" y="%mb_row2_icon_y%" w="%mb_icon_w%" h="%mb_icon_h%"/>
			</fill>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x%" y="%mb_row2_y%"/>
				<image resource="mb_wipe_color"/>
			</image>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x_neg%" y="%mb_row2_y%" placement="1"/>
				<image resource="mb_color_extension"/>
			</image>

			<text style="mb_text">
				<placement x="%col1_x_indent%" y="%mb_row2_text_y%"/>
				<text>{@wipe_btn=Wipe}</text>
			</text>

			<button style="mb_btn">
				<placement x="%col1_x%" y="%mb_row2_y%" w="%content_w%" h="%mb_h%"/>
				<action function="set">partitionlisterror=0</action>
				<action function="page">wipe</action>
			</button>

			<image>
				<condition var1="menu_btn_solid" var2="0"/>
				<placement x="%col1_x%" y="%mb_row3_y%"/>
				<image resource="mb_backup"/>
			</image>

			<fill color="%accent%">
				<condition var1="alt_style_btn" var2="0"/>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%mb_icon_x%" y="%mb_row3_icon_y%" w="%mb_icon_w%" h="%mb_icon_h%"/>
			</fill>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x%" y="%mb_row3_y%"/>
				<image resource="mb_backup_color"/>
			</image>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x_neg%" y="%mb_row3_y%" placement="1"/>
				<image resource="mb_color_extension"/>
			</image>

			<text style="mb_text">
				<placement x="%col1_x_indent%" y="%mb_row3_text_y%"/>
				<text>{@backup_btn=Backup}</text>
			</text>

			<button style="mb_btn">
				<condition var1="auto_generate" var2="0"/>
				<placement x="%col1_x%" y="%mb_row3_y%" w="%content_w%" h="%mb_h%"/>
				<actions>
					<action function="set">tw_backup_name={@auto_gen=(Auto Generate)}</action>
					<action function="set">tw_fileexists=0</action>
					<action function="set">adb_backup_pc=0</action>
					<action function="page">backup_device</action>
				</actions>
			</button>

			<button style="mb_btn">
				<condition var1="auto_generate" var2="1"/>
				<placement x="%col1_x%" y="%mb_row3_y%" w="%content_w%" h="%mb_h%"/>
				<actions>
					<action function="generatebackupname"/>
					<action function="set">tw_fileexists=0</action>
					<action function="set">adb_backup_pc=0</action>
					<action function="page">backup_device</action>
				</actions>
			</button>
			
			<button style="mb_btn">
				<condition var1="auto_generate" var2="2"/>
				<placement x="%col1_x%" y="%mb_row3_y%" w="%content_w%" h="%mb_h%"/>
				<action function="set">tw_fileexists=0</action>
				<action function="set">adb_backup_pc=0</action>
				<action function="page">backup_device</action>
			</button>

			<image>
				<condition var1="menu_btn_solid" var2="0"/>
				<placement x="%col1_x%" y="%mb_row4_y%"/>
				<image resource="mb_restore"/>
			</image>

			<fill color="%accent%">
				<condition var1="alt_style_btn" var2="0"/>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%mb_icon_x%" y="%mb_row4_icon_y%" w="%mb_icon_w%" h="%mb_icon_h%"/>
			</fill>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x%" y="%mb_row4_y%"/>
				<image resource="mb_restore_color"/>
			</image>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x_neg%" y="%mb_row4_y%" placement="1"/>
				<image resource="mb_color_extension"/>
			</image>

			<text style="mb_text">
				<placement x="%col1_x_indent%" y="%mb_row4_text_y%"/>
				<text>{@restore_btn=Restore}</text>
			</text>

			<button style="mb_btn">
				<placement x="%col1_x%" y="%mb_row4_y%" w="%content_w%" h="%mb_h%"/>
				<action function="page">restore</action>
			</button>

			<image>
				<condition var1="menu_btn_solid" var2="0"/>
				<placement x="%col1_x%" y="%mb_row5_y%"/>
				<image resource="mb_mount"/>
			</image>

			<fill color="%accent%">
				<condition var1="alt_style_btn" var2="0"/>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%mb_icon_x%" y="%mb_row5_icon_y%" w="%mb_icon_w%" h="%mb_icon_h%"/>
			</fill>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x%" y="%mb_row5_y%"/>
				<image resource="mb_mount_color"/>
			</image>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x_neg%" y="%mb_row5_y%" placement="1"/>
				<image resource="mb_color_extension"/>
			</image>

			<text style="mb_text">
				<placement x="%col1_x_indent%" y="%mb_row5_text_y%"/>
				<text>{@mount_btn=Mount}</text>
			</text>

			<button style="mb_btn">
				<placement x="%col1_x%" y="%mb_row5_y%" w="%content_w%" h="%mb_h%"/>
				<action function="page">mount</action>
			</button>

			<image>
				<condition var1="menu_btn_solid" var2="0"/>
				<placement x="%col1_x%" y="%mb_row6_y%"/>
				<image resource="mb_filemanager"/>
			</image>

			<fill color="%accent%">
				<condition var1="alt_style_btn" var2="0"/>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%mb_icon_x%" y="%mb_row6_icon_y%" w="%mb_icon_w%" h="%mb_icon_h%"/>
			</fill>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x%" y="%mb_row6_y%"/>
				<image resource="mb_filemanager_color"/>
			</image>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x_neg%" y="%mb_row6_y%" placement="1"/>
				<image resource="mb_color_extension"/>
			</image>

			<text style="mb_text">
				<condition var1="aroma_enabled" var2="0"/>
				<placement x="%col1_x_indent%" y="%mb_row6_text_y%"/>
				<text>{@file_manager_btn=File Manager}</text>
			</text>
			
			<text style="mb_text">
				<condition var1="aroma_enabled" var2="1"/>
				<placement x="%col1_x_indent%" y="%mb_row6_text_y%"/>
				<text>AromaFM</text>
			</text>

			<button style="mb_btn">
				<condition var1="aroma_enabled" var2="1"/>
				<condition var1="aroma_path" op="!=" var2="none"/>
				<placement x="%col1_x%" y="%mb_row6_y%" w="%content_w%" h="%mb_h%"/>
				<action function="queueclear"/>
				<action function="set">tw_filename=%aroma_path%</action>
				<action function="set">tw_signed_zip_verify_tmp=%tw_signed_zip_verify%</action>
				<action function="set">tw_signed_zip_verify=0</action>
				<action function="queuezip"/>
				<action function="flash">aroma_busy</action>
			</button>
			
			<button style="mb_btn">
				<condition var1="aroma_enabled" var2="0"/>
				<condition var1="aroma_path" op="!=" var2="none"/>
				<placement x="%col1_x%" y="%mb_row6_y%" w="%content_w%" h="%mb_h%"/>
				<action function="page">filemanagerlist</action>
			</button>
			
			<!-- Fool Protection -->
			<button style="mb_btn">
				<condition var1="aroma_path" var2="none"/>
				<placement x="%col1_x%" y="%mb_row6_y%" w="%content_w%" h="%mb_h%"/>
				<action function="page">filemanagerlist</action>
			</button>

			<image>
				<condition var1="menu_btn_solid" var2="0"/>
				<placement x="%col1_x%" y="%mb_row7_y%"/>
				<image resource="mb_advanced"/>
			</image>

			<fill color="%accent%">
				<condition var1="alt_style_btn" var2="0"/>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%mb_icon_x%" y="%mb_row7_icon_y%" w="%mb_icon_w%" h="%mb_icon_h%"/>
			</fill>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x%" y="%mb_row7_y%"/>
				<image resource="mb_advanced_color"/>
			</image>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x_neg%" y="%mb_row7_y%" placement="1"/>
				<image resource="mb_color_extension"/>
			</image>

			<text style="mb_text">
				<placement x="%col1_x_indent%" y="%mb_row7_text_y%"/>
				<text>{@advanced_btn=Advanced}</text>
			</text>

			<button style="mb_btn">
				<placement x="%col1_x%" y="%mb_row7_y%" w="%content_w%" h="%mb_h%"/>
				<action function="page">advanced</action>
			</button>

			<image>
				<condition var1="menu_btn_solid" var2="0"/>
				<placement x="%col1_x%" y="%mb_row8_y%"/>
				<image resource="mb_restart"/>
			</image>

			<fill color="%accent%">
				<condition var1="alt_style_btn" var2="0"/>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%mb_icon_x%" y="%mb_row8_icon_y%" w="%mb_icon_w%" h="%mb_icon_h%"/>
			</fill>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x%" y="%mb_row8_y%"/>
				<image resource="mb_restart_color"/>
			</image>

			<image>
				<condition var1="menu_btn_solid" var2="1"/>
				<placement x="%col1_x_neg%" y="%mb_row8_y%" placement="1"/>
				<image resource="mb_color_extension"/>
			</image>

			<text style="mb_text">
				<placement x="%col1_x_indent%" y="%mb_row8_text_y%"/>
				<text>{@reboot_btn=Reboot}</text>
			</text>

			<button style="mb_btn">
				<placement x="%col1_x%" y="%mb_row8_y%" w="%content_w%" h="%mb_h%"/>
				<action function="page">reboot</action>
			</button>

			<fill color="%linecolor%">
				<condition var1="menu_btn_solid" var2="0"/>
				<condition var1="alt_style_btn" var2="0"/>
				<placement x="%col1_x_indent%" y="%mb_row2_y%" w="%mb_div_w%" h="%fileselector_separatorheight%"/>
			</fill>

			<fill color="%linecolor%">
				<condition var1="menu_btn_solid" var2="0"/>
				<condition var1="alt_style_btn" var2="0"/>
				<placement x="%col1_x_indent%" y="%mb_row3_y%" w="%mb_div_w%" h="%fileselector_separatorheight%"/>
			</fill>

			<fill color="%linecolor%">
				<condition var1="menu_btn_solid" var2="0"/>
				<condition var1="alt_style_btn" var2="0"/>
				<placement x="%col1_x_indent%" y="%mb_row4_y%" w="%mb_div_w%" h="%fileselector_separatorheight%"/>
			</fill>

			<fill color="%linecolor%">
				<condition var1="menu_btn_solid" var2="0"/>
				<condition var1="alt_style_btn" var2="0"/>
				<placement x="%col1_x_indent%" y="%mb_row5_y%" w="%mb_div_w%" h="%fileselector_separatorheight%"/>
			</fill>

			<fill color="%linecolor%">
				<condition var1="menu_btn_solid" var2="0"/>
				<condition var1="alt_style_btn" var2="0"/>
				<placement x="%col1_x_indent%" y="%mb_row6_y%" w="%mb_div_w%" h="%fileselector_separatorheight%"/>
			</fill>

			<fill color="%linecolor%">
				<condition var1="menu_btn_solid" var2="0"/>
				<condition var1="alt_style_btn" var2="0"/>
				<placement x="%col1_x_indent%" y="%mb_row7_y%" w="%mb_div_w%" h="%fileselector_separatorheight%"/>
			</fill>

			<fill color="%linecolor%">
				<condition var1="menu_btn_solid" var2="0"/>
				<condition var1="alt_style_btn" var2="0"/>
				<placement x="%col1_x_indent%" y="%mb_row8_y%" w="%mb_div_w%" h="%fileselector_separatorheight%"/>
			</fill>
		</page>
	</pages>
</recovery>